<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-/mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.DreamBook.BookStoreService.mapper.book.BookMapper">


    <select id="maxNum" resultType="int">
        select nvl(max(bookId),0) from book
    </select>


    <select id="maxNumCart" resultType="int">
        select nvl(max(cartId),0) from cart
    </select>



        <insert id="insertData" parameterType="com.DreamBook.BookStoreService.dto.book.BookAddDTO">

        insert into book(bookId,memberId,bookName,bookContent,author,publisher,genre,
                         fileName,filePath,price,salesQuantity,bookLoan,views,publicationYear)
        values (#{bookId},#{memberId},#{bookName},#{bookContent},#{author},#{publisher},
                #{genre},#{fileName},#{filePath},#{price},#{salesQuantity},1,0,#{publicationYear})

        </insert>

    <insert id="bookCartInsertData" parameterType="com.DreamBook.BookStoreService.dto.book.BookCartDTO">

    insert into cart(cartId,memberId,bookId,amount)
    values (#{cartId},#{memberId},#{bookId},#{amount})

    </insert>

    <select id="bookList"  resultType="com.DreamBook.BookStoreService.dto.book.BookFindDTO">
        select * from book



    </select>

    <select id="bookListHighPrice"  resultType="com.DreamBook.BookStoreService.dto.book.BookFindDTO">

        SELECT a.*,b.grade from book a
        left join review b on a.bookId = b.bookId


        WHERE a.bookId IN

        <foreach item="bookAndReview" collection="bookAndReview" open="(" close=")" separator=",">
            #{bookAndReview.bookId}
        </foreach>


        order by price desc

    </select>

    <select id="bookListLowPrice"  resultType="com.DreamBook.BookStoreService.dto.book.BookFindDTO">
        SELECT a.*,b.grade from book a
        left join review b on a.bookId = b.bookId


        WHERE a.bookId IN

        <foreach item="bookAndReview" collection="bookAndReview" open="(" close=")" separator=",">
            #{bookAndReview.bookId}
        </foreach>


        order by price asc



    </select>

    <select id="bookIdList"  resultType="com.DreamBook.BookStoreService.dto.book.BookFindDTO"
    parameterType="int">
        select * from book
        where bookId = #{bookId}



    </select>

    <select id="bookIdList2" resultType="com.DreamBook.BookStoreService.dto.book.BookFindDTO">
        SELECT a.* ,b.orderId from book a
        left join orders b on a.bookId = b.bookId


        WHERE b.bookId IN
        <foreach item="orderIdList" collection="orderIdList" open="(" close=")" separator=",">
            #{orderIdList.bookId}
        </foreach>


    </select>

    <select id="bookCartList"  resultType="com.DreamBook.BookStoreService.dto.book.BookDTO"
            parameterType="int">
        select  * from  book a
                           LEFT JOIN cart b ON
            a.bookId = b.bookId
                           LEFT JOIN member c ON
            b.memberId =c.memberId
        where b.memberId =1
        ORDER BY b.bookId



    </select>


    <update id="update" parameterType="com.DreamBook.BookStoreService.dto.book.BookDTO">



            UPDATE 	cart
            SET		wishQuantity = #{bookDTO.wishQuantity}
        WHERE	bookId in
        <foreach item="bookCartList" collection="bookCartList" open="(" close=")" separator=",">
            #{bookCartList.bookId}
        </foreach>

    </update>

    <update id="updateWishQuantity" parameterType="com.DreamBook.BookStoreService.dto.book.BookCartDTO">

        update cart
        set    wishQuantity = wishQuantity+1
        WHERE	cartId = #{cartId} or bookId = #{bookId}

    </update>

    <update id="updateAmount" parameterType="com.DreamBook.BookStoreService.dto.book.BookCartDTO">

        update cart
        set    amount = wishQuantity * #{price}
        WHERE	cartId = #{cartId}  or bookId = #{bookId}

    </update>

    <select id="bookAndReview" resultType="com.DreamBook.BookStoreService.dto.book.BookFindDTO">
        SELECT a.*,b.grade from book a
        left join review b on a.bookId = b.bookId


        WHERE a.bookId IN

        <foreach item="bookAndReview" collection="bookAndReview" open="(" close=")" separator=",">
            #{bookAndReview.bookId}
        </foreach>




    </select>


<!--    <select id="orderIdList" resultType="com.DreamBook.BookStoreService.dto.order.OrderDTO">-->
<!--        SELECT distinct orderNum, bookId from orders-->

<!--        WHERE orderNum IN-->
<!--        <foreach item="list" collection="list" open="(" close=")" separator=",">-->
<!--            #{list.orderNum}-->
<!--        </foreach>-->
<!--        order by orderNum-->

<!--    </select>-->



<!--    <select id="loginData" parameterType="com.DreamBook.BookStoreService.dto.member.MemberFindDTO"-->
<!--    resultType="Integer">-->
<!--        select nvl(count(*),0) from member-->
<!--        where userId =#{userId} and pwd = #{pwd}-->

<!--    </select>-->

<!--    <select id="findId" parameterType="com.DreamBook.BookStoreService.dto.member.MemberFindDTO"-->
<!--            resultType="Integer">-->
<!--        select nvl(count(*),0) from member-->
<!--        where name =#{name} and email = #{email}-->

<!--    </select>-->

<!--    <select id="findUserId" parameterType="com.DreamBook.BookStoreService.dto.member.MemberFindDTO"-->
<!--           resultType="String" >-->
<!--        select userId from member-->
<!--        where name =#{name} and email = #{email}-->

<!--    </select>-->



<!--    <select id="findPwd" parameterType="com.DreamBook.BookStoreService.dto.member.MemberFindDTO"-->
<!--            resultType="String" >-->
<!--        select pwd from member-->
<!--        where userId =#{userId} and email = #{email}-->

<!--    </select>-->

<!--    <select id="IdCheck" parameterType="String"-->
<!--            resultType="Integer">-->
<!--        select nvl(count(*),0) from member-->
<!--        where userId =#{id}-->

<!--    </select>-->






</mapper>
